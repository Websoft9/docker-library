# image,docs: https://hub.docker.com/r/trafficserver/trafficserver
# Apache Traffic Server is a high-performance HTTP proxy and cache server

services:

  trafficserver:
    image: $W9_REPO:$W9_VERSION
    container_name: $W9_ID
    restart: unless-stopped
    ports:
      - $W9_HTTP_PORT_SET:8080
      # Management port
      - 8088:8088
    env_file: .env
    volumes:
      - trafficserver_config:/etc/trafficserver
      - trafficserver_logs:/var/log/trafficserver
      - trafficserver_cache:/var/cache/trafficserver
      - ./src/records.config:/etc/trafficserver/records.config:ro
      - ./src/records.yaml:/etc/trafficserver/records.yaml:ro
      - ./src/remap.config:/etc/trafficserver/remap.config:ro
      - ./src/hosting.config:/etc/trafficserver/hosting.config:ro
    environment:
      - TS_ROOT_PASSWORD=$W9_POWER_PASSWORD
    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  trafficserver_config:
  trafficserver_logs:
  trafficserver_cache:
    
networks:
  default:
    name: $W9_NETWORK
    external: true
